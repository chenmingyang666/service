<!doctype html>

<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../../../layui/css/layui.css">
    <style>
        .layui-form-select .layui-input {
            padding-right: 0;
        }

        .layui-table-cell {
            height: auto;
        }
    </style>
    <script src="../../../layui/layui.js"></script>
    <script src="../../lay/modules/jquery.js"></script>

</head>

<body>

    <form class="layui-form searchBOx" style=" padding: 10px;background-color: white" action="">
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">项目名字：</label>
                <div class="layui-input-block">
                    <input type="text" name="title" required lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">设备名称：</label>
                <div class="layui-input-block">
                    <input type="text" name="title" required lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">设备状态：</label>
                <div class="layui-input-block">
                    <select name="device_state" lay-filter="state" lay-verify="">
                        <option value="">请选择一个状态</option>
                        <option value="1">全部</option>
                        <option value="2">使用中</option>
                        <option value="3">空闲</option>
                        <option value="4">离线</option>
                        <option value="5">维护中</option>
                        <option value="6">锁定</option>
                    </select>
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">是否上线：</label>
                <div class="layui-input-block">
                    <select name="is_online" lay-verify="">
                        <option value="">请选择一个状态</option>
                        <option value="1">全部</option>
                        <option value="2">启动</option>
                        <option value="3">关闭</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">校区/社区：</label>
                <div class="layui-input-block">
                    <select name="is_online" lay-verify="">
                        <option value="">请选择一个校区</option>
                        <option value="1">全部</option>
                        <option value="2">河南大学理工学院</option>

                    </select>
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">设备类型：</label>
                <div class="layui-input-block">
                    <select name="is_online" lay-verify="">
                        <option value="">请选择一个类型</option>
                        <option value="1">全部</option>
                        <option value="2">启动</option>
                    </select>
                </div>
            </div>
            <div class="layui-inline" style="float: right;">
                <button class="layui-btn layui-btn-normal">查询</button>
                <button class="layui-btn layui-btn-normal">重置</button>
            </div>
        </div>

    </form>
    <div class="layui-form">
        <table class="layui-table" id="data_demo">
            <div class="demoTable">
                <button class="layui-btn layui-btn-primary" style="float: right;" data-type="getCheckData">导出</button>

            </div>





        </table>
        <!-- 分页控件div -->
        <div id="pageControl"></div>
    </div>



    <script id="data_table" type="text/html">

        {{# layui.each(giveData, function(index, item){ }}
        <tr data-index="{{index}}">
            <td data-field="{{index}}">
                <div class="layui-form layui-table-cell laytable-cell-1-0 laytable-cell-checkbox">
                    <input type="checkbox" name="singItem" lay-skin="primary" lay-filter="itemChoose">
                    <div class="layui-unselect layui-form-checkbox" lay-skin="primary">

                        <i class="layui-icon layui-icon-ok"></i>
                    </div>
                </div>
            </td>
            <td data-field="id">
                <div class="layui-table-cell laytable-cell-1-id">{{item.id}}</div>
            </td>
            <td data-field="username">
                {{item.username}}
            </td>
            <td data-field="sex">
                {{item.sex}}
            </td>
            <td data-field="city">
                {{item.city}}
            </td>
            <td data-field="sign">
                {{item.sign}}
            </td>
            <td data-field="experience">
                {{item.experience}}
            </td>
            <td data-field="score">
                {{item.score}}
            </td>
            <td data-field="classify">
                {{item.classify}}
            </td>
            <td data-field="is_online">
                <div class="layui-table-cell laytable-cell-1-is_online">{{# if(item.is_online ===true){ }}
                    <div class="layui-form">
                        <input type="checkbox" checked='' name="open" lay-skin="switch" lay-text="启用|关闭" lay-filter="deviceControl">
                    </div>
                    {{# }else{ }}
                    <div class="layui-form">
                        <input type="checkbox" name="close" lay-skin="switch" lay-text="启用|关闭" lay-filter="deviceControl">
                    </div>
                    {{# } }}
                </div>
            </td>
        </tr>
        {{# }); }}


    </script>
    <script type="text/html" id="sexTpl">
        {{# if(d.sex === '女'){ }}
        <span style="color: #F581B1;">{{ d.sex }}</span>
        {{# } else { }} {{ d.sex }} {{# } }}
    </script>
    <script type="text/html" id="checkboxTpl">
        <!-- 这里的 checked 的状态只是演示 -->
    

            {{# if(d.is_online ===true){ }}
           
                <input type="checkbox" checked='' value="{{d.is_online}}" name="open" lay-skin="switch" lay-text="启用|关闭" lay-filter="deviceControl">
             
            {{# }else{ }}
            
                <input type="checkbox" name="close" lay-skin="switch" lay-text="启用|关闭" lay-filter="deviceControl">
           
            {{# } }}

    </script>
    <script src="data.js">
    </script>

    <script>
        layui.use(['layer', 'form', 'table', 'laytpl', 'laypage'], function () {
            var $ = layui.$,
                layer = layui.layer,
                form = layui.form,
                table = layui.table,
                laytpl = layui.laytpl,
                laypage = layui.laypage,
                active = {
                    getCheckData: function () { //获取选中数据
                        var checkStatus = table.checkStatus('data_demo'),
                            data = checkStatus.data;
                        layer.alert(JSON.stringify(data));
                    },
                    getCheckLength: function () { //获取选中数目
                        var checkStatus = table.checkStatus('data_demo'),
                            data = checkStatus.data;
                        layer.msg('选中了：' + data.length + ' 个');
                    },
                    isAll: function () { //验证是否全选
                        var checkStatus = table.checkStatus('data_demo');
                        layer.msg(checkStatus.isAll ? '全选' : '未全选')
                    }
                };
               
            // layer.msg('能用吗');
            form.on('select(state)', function (data) {
                layer.msg(data.value)
            });



            // 展示搜索结果的表格
            table.render({
                elem: '#data_demo',
                cols: [
                    [{
                        checkbox: true,
                        fixed: true
                    }, {
                        field: 'id',
                        title: 'ID',

                        sort: true,
                        fixed: true
                    }, {
                        field: 'username',
                        title: '用户名',
                    }, {
                        field: 'sex',
                        title: '性别',
                        templet: '#sexTpl',

                        sort: true
                    }, {
                        field: 'city',
                        title: '城市',
                    }, {
                        field: 'sign',
                        title: '签名',
                        width: 100
                    }, {
                        field: 'experience',
                        title: '积分',
                        sort: true,
                    }, {
                        field: 'score',
                        title: '评分',
                        sort: true,
                    }, {
                        field: 'classify',
                        title: '职业',
                    }, {
                        field: 'wealth',
                        title: '财富',
                        sort: true,
                        width: 135
                    
                    }, {
                        field: 'is_online',
                        title: '是否锁定',
                        templet:'#checkboxTpl',
                        width: 135
                    }]
                ],
                data: giveData,
                page: true //开启分页

            });
            // 分页内容
            // var getTpl = document.getElementById('data_table').innerHTML,
            //     view = document.getElementById('show_table');
            // console.log(laytpl);
            // //    分页渲染
            // laytpl(getTpl).render(giveData, function (html) {
            //     view.innerHTML = html;
            //     form.render();

            // });

            // 导出表格数据
            $('.demoTable .layui-btn').on('click', function () {
                var type = $(this).data('type');
                active[type] ? active[type].call(this) : '';
            });

            //监听锁定操作
            // form.on('checkbox(deviceControl)', function (obj) {
            //     layer.tips(this.value + ' ' + this.name + '：' + obj.elem.checked, obj.othis);
            // });



            // 全选和反选
            form.on('checkbox(allChoose)', function (data) {
                console.log(data);
                var child = $(data.elem).parents('table').find('tbody input[name="singItem"]');
                child.each(function (index, item) {
                    item.checked = data.elem.checked;
                });
                form.render('checkbox');

            });
            form.on('checkbox(itemChoose)', function (data) {
                var sib = $(data.elem).parents('table').find('tbody input[name="singItem"]:checked').length;
                var total = $(data.elem).parents('table').find('tbody input[name="singItem"]').length;
                if (sib == total) {
                    $(data.elem).parents('table').find('thead input[name="singItem"]').prop("checked",
                        true);
                    form.render();
                } else {
                    $(data.elem).parents('table').find('thead input[name="singItem"]').prop("checked",
                        false);
                    form.render();
                }
            });
            //    设备控制开关
            form.on('switch(deviceControl)', function (data) {
                console.log($(data.elem).parents('tr').attr('data-index'));
                console.log(data.elem.checked); //开关是否开启，true或者false
                console.log(data.value); //开关value值，也可以通过data.elem.value得到
                console.log(data.othis); //得到美化后的DOM对象
                layer.tips(this.value + ' ' + this.name + '：' + data.elem.checked, data.othis);
            });




        });
    </script>

</body>