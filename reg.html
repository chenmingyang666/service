<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <!-- IE兼容模式 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <!-- 国产浏览器兼容模式 -->
    <meta name="renderer" content="webkit">
    <meta name="author" content="Cmy">
    <title>集优科技-注册</title>
    <meta name="keywords" content="集优科技">
    <meta name="description" content="集优科技">
    <link rel="icon" href="images/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="css/layui.css">
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
    <link href="css/login.css" rel="stylesheet">
    <script type='text/javascript' src="js/jquery.min.js"></script>
    <!-- 登录页线粒背景 -->
    <script type='text/javascript' src='js/jquery.particleground.min.js'></script>
    <style>
        .layadmin-user-jump-change {
            color: #1890ff !important;
        }
        ::-webkit-scrollbar {
            display: none;
        }
    </style>
    <script>
        // 背景canvas
        $(document).ready(function () {
            $('#particles').particleground({
                dotColor: '#1890ff',
                lineColor: '#1890ff'
            });
        });
    </script>
</head>

<body class="layui-layout-body">
    <div id="particles">
        <div class="layadmin-user-login layadmin-user-display-show" id="LAY-user-login" style="display: none;">
            <div class="layadmin-user-login-main">
                <div class="layadmin-user-login-box layadmin-user-login-header">
                    <h2>集优生活</h2>
                    <p>集优科技官方出品的后台管理系统</p>
                </div>
                <div class="layadmin-user-login-box layadmin-user-login-body layui-form">
                    <!-- <div class="layui-form-item">
                        <label class="layadmin-user-login-icon layui-icon layui-icon-user" for="LAY-user-login-cellphone"></label>
                        <input type="text" name="userName" id="LAY-user-login-username" lay-verify="userName" placeholder="用户名" class="layui-input">
                    </div> -->
                    <div class="layui-form-item">
                        <label class="layadmin-user-login-icon layui-icon layui-icon-cellphone" for="LAY-user-login-cellphone"></label>
                        <input type="text" name="account" id="LAY-user-login-cellphone" lay-verify="phone" placeholder="手机"
                            class="layui-input">
                    </div>
                    <div class="layui-form-item">
                        <label class="layadmin-user-login-icon layui-icon layui-icon-password" for="LAY-user-login-password"></label>
                        <input type="password" name="password" id="LAY-user-login-password" lay-verify="password|required"
                            placeholder="密码" class="layui-input">
                    </div>
                    <div class="layui-form-item">
                        <label class="layadmin-user-login-icon layui-icon layui-icon-password" for="LAY-user-login-repass"></label>
                        <input type="password" name="repass" id="LAY-user-login-repass" lay-verify="password|required"
                            placeholder="确认密码" class="layui-input">
                    </div>
                    <div class="layui-form-item">
                        <div class="layui-row">
                            <div class="layui-col-xs7">
                                <label class="layadmin-user-login-icon layui-icon layui-icon-vercode" for="LAY-user-login-vercode"></label>
                                <input type="text" name="smsCode" id="LAY-user-login-vercode" lay-verify="required"
                                    placeholder="验证码" class="layui-input">
                            </div>
                            <div class="layui-col-xs5">
                                <div style="margin-left: 10px;">
                                    <input type="button" class="layui-btn layui-btn-primary layui-btn-fluid" id="LAY-user-getsmscode"
                                        value="获取验证码" />
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- <div class="layui-form-item">
                        <label class="layadmin-user-login-icon layui-icon layui-icon-chart" for="LAY-user-login-email"></label>
                        <input type="text" name="email" id="LAY-user-login-email" placeholder="邮箱" class="layui-input">
                    </div> -->
                    <!-- <div class="layui-form-item">
                        <input type="checkbox" name="agreement" lay-skin="primary" title="同意用户协议" checked>
                    </div> -->
                    <div class="layui-form-item">
                        <button class="layui-btn layui-btn-fluid" lay-submit id="LAY-user-reg-submit" lay-filter="LAY-user-reg-submit" style="background-color: #1890ff !important;">注册</button>
                    </div>
                    <div class="layui-trans layui-form-item layadmin-user-login-other">
                        <a href="login.html" class="layadmin-user-jump-change layadmin-link layui-hide-xs">用已有帐号登入</a>
                    </div>
                </div>
            </div>
            <div class="layui-trans layadmin-user-login-footer">
                <p>© 2018
                    <a href="http://jiyoukeji.cn" target="_blank">gelives.com</a>
                </p>
            </div>
        </div>
    </div>
    <script src="js/layui.js"></script>
    <script src="js/lay/modules/jquery.js"></script>
    <script src="js/global.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
  <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
  <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script>
        layui.config({
            base: 'js/lay/modules/'
        }).extend({
            index: ''
        }).use(['jquery', 'common', 'form'], function () {
            var $ = layui.jquery,
                common = layui.common,
                form = layui.form,
                count;
            //发送验证码
            $("#LAY-user-getsmscode").click(function () {
                var disabled = $("#LAY-user-getsmscode").attr("disabled");
                if (disabled) {
                    return false;
                };
                if ($("#LAY-user-login-cellphone").val() == "" || isNaN($("#LAY-user-login-cellphone").val()) ||
                    $("#LAY-user-login-cellphone").val().length != 11) {
                    layer.alert("请填写正确的手机号！");
                    return false;
                };
                $.ajax({
                    async: false,
                    type: "GET",
                    url: common.baseUrl + "code/sms",
                    data: {
                        mobile: $("#LAY-user-login-cellphone").val()
                    },
                    dataType: "json",
                    async: false,
                    success: function (data) {
                        if(data.code==200){
                              layer.msg('发送成功');
                              settime();
                        }else{
                            layer.msg(data.message);
                        }
                      
                    },
                    error: function (err) {
                        layer.msg('发送失败')
                    }
                });
            });
            var countdown = 60;
            var _generate_code = $("#LAY-user-getsmscode");
            function settime() {
                if (countdown == 0) {
                    _generate_code.attr("disabled", false);
                    _generate_code.val("获取验证码");
                    countdown = 60;
                    return false;
                } else {
                    $("#LAY-user-getsmscode").attr("disabled", true);
                    _generate_code.val("重新发送(" + countdown + ")");
                    countdown--;
                }
                setTimeout(function () {
                    settime();
                }, 1000);
            };
            $(document).keydown(function (event) {
                if (event.keyCode == 13) {
                    document.getElementById("LAY-user-reg-submit").click();
                }
            });
            //提交
            form.on('submit(LAY-user-reg-submit)', function (obj) {
                var field = obj.field;
                console.log(obj.field)
                //确认密码
                if (field.password !== field.repass) {
                    return layer.msg('两次密码输入不一致');
                };
                //请求接口
                common.regUser(field, function (res) {
                    console.log(res);
                    if (res.code == 200) {
                        layer.msg('注册成功', {
                            offset: '15px',
                            icon: 1,
                            time: 1000
                        }, function () {
                            // common.loginRequest(field, function (res) {
                                console.log(res);
                                if (res.data) {
                                    layui.sessionData('token', {
                                        key: 'token',
                                        value: res.data.token
                                    });
                                    layui.sessionData('nickName', {
                                        key: 'nickName',
                                        value: res.data.nickName
                                    });
                                    layui.sessionData('account', {
                                        key: 'account',
                                        value: res.data.account
                                    });
                                    layui.sessionData('id', {
                                        key: 'id',
                                        value: res.data.id
                                    });
                                };
                                // if (res.code == 200) {
                                    layer.msg('登入主页成功', {
                                        offset: '15px',
                                        icon: 1,
                                        time: 1000
                                    }, function () {
                                        location.href = 'index.html'; //后台主页
                                    });
                                // } 
                            // });
                           
                        });
                    } else if (res.code == 500) {
                        layer.msg(res.message)
                    } else {
                        layer.msg('注册失败')
                    }
                });
                return false;
            });
        })
    </script>
</body>

</html>